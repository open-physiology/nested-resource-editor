<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/panels/NestedResourceList.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/open-physiology/nested-resource-editor" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/components/CustomSelectModule.js~CustomSelectModule.html">CustomSelectModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/components/CustomSelectModule.js~MultiSelectInput.html">MultiSelectInput</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/components/CustomSelectModule.js~SingleSelectInput.html">SingleSelectInput</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common/toolbars</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/toolbars/ToolbarSettingsModule.js~ToolbarPropertySettings.html">ToolbarPropertySettings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/toolbars/ToolbarSettingsModule.js~ToolbarSettingsModule.html">ToolbarSettingsModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/MeasurableGeneratorModule.js~MeasurableGenerator.html">MeasurableGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/MeasurableGeneratorModule.js~MeasurableGeneratorModule.html">MeasurableGeneratorModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">panels</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/AbstractResourceList.js~AbstractResourceList.html">AbstractResourceList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/HighlightService.js~HighlightService.html">HighlightService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/ItemHeader.js~ItemHeader.html">ItemHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/NestedResourceList.js~NestedResourceList.html">NestedResourceList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/NestedResourceWidgetModule.js~NestedResourceWidget.html">NestedResourceWidget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/NestedResourceWidgetModule.js~NestedResourceWidgetModule.html">NestedResourceWidgetModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/ResourcePanelModule.js~ResourcePanel.html">ResourcePanel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/ResourcePanelModule.js~ResourcePanelModule.html">ResourcePanelModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">test-app</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/test-app/app.js~TestApp.html">TestApp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/test-app/app.js~TestAppModule.html">TestAppModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">toolbars</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarAddModule.js~ToolbarAdd.html">ToolbarAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarAddModule.js~ToolbarAddModule.html">ToolbarAddModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarCommandsModule.js~ToolbarCommands.html">ToolbarCommands</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarCommandsModule.js~ToolbarCommandsModule.html">ToolbarCommandsModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarFilterModule.js~ToolbarFilter.html">ToolbarFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarFilterModule.js~ToolbarFilterModule.html">ToolbarFilterModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarSortModule.js~ToolbarSort.html">ToolbarSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarSortModule.js~ToolbarSortModule.html">ToolbarSortModule</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/panels/NestedResourceList.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import {Component, Input} from &apos;@angular/core&apos;;
import {AbstractResourceList} from &quot;./AbstractResourceList&quot;;
import {HighlightService} from &apos;./HighlightService.js&apos;;
import {ToastyService} from &apos;ng2-toasty&apos;;
import {SetToArray, FilterBy} from &quot;../common/PipeTransformModule&quot;;

@Component({
    selector: &apos;nested-resource-list&apos;,
    template:`
        &lt;div class=&quot;panel repo-nested&quot;&gt;
            &lt;div class=&quot;panel-heading&quot;&gt;&lt;label&gt;{{caption}}: &lt;/label&gt;&lt;/div&gt;
            &lt;div class=&quot;panel-body&quot;&gt;
        &lt;span *ngIf=&quot;!(options?.readOnly || options?.headersOnly)&quot;&gt;
          &lt;select-input-1 class=&quot;pull-left input-select&quot;
                          [item]=&quot;_itemToInclude&quot;
                          (updated)=&quot;_itemToInclude = $event&quot;
                          [options]=&quot;possibleValues&quot;&gt;
          &lt;/select-input-1&gt;
          &lt;button type=&quot;button&quot; class=&quot;btn btn-default btn-icon&quot; (click)=&quot;_onIncluded(_itemToInclude)&quot;&gt;
            &lt;span class=&quot;glyphicon glyphicon-save&quot;&gt;&lt;/span&gt;
          &lt;/button&gt;
        &lt;/span&gt;

                &lt;toolbar-sort *ngIf=&quot;options?.sortToolbar&quot; [options]=&quot;[&apos;Name&apos;, &apos;ID&apos;, &apos;Class&apos;]&quot;
                              (sorted)=&quot;_onSorted($event)&quot;&gt;&lt;/toolbar-sort&gt;
                &lt;toolbar-add *ngIf=&quot;!(options?.readOnly || options?.headersOnly)&quot; [options]=&quot;types&quot;
                             [transform]=&quot;_getClassLabel&quot; (added)=&quot;_onAdded($event)&quot;&gt;&lt;/toolbar-add&gt;
                &lt;toolbar-filter *ngIf=&quot;options?.filterToolbar&quot; [options]=&quot;[&apos;Name&apos;, &apos;ID&apos;, &apos;Class&apos;]&quot;
                                [filter]=&quot;_searchString&quot; (applied)=&quot;_onFiltered($event)&quot;&gt;&lt;/toolbar-filter&gt;

                &lt;!--| orderBy : _sortByMode--&gt;

                &lt;accordion [closeOthers]=&quot;true&quot;
                           dnd-sortable-container [dropZones]=&quot;_zones&quot; [sortableData]=&quot;items&quot;&gt;
                    &lt;accordion-group *ngFor=&quot;let item of items 
            | filterBy: [_searchString, _filterByMode]; let i = index&quot; class=&quot;list-group-item&quot;
                                     dnd-sortable [dragEnabled]=true
                                     [sortableIndex]=&quot;i&quot;
                                     (onDragEnd)=&quot;_onDragEnd(i)&quot;

                                     (onOpen)=&quot;openItem = item&quot;
                                     (onClose)=&quot;openItem = null&quot;&gt;

                        &lt;accordion-heading (click)=&quot;selectedItem = item&quot;&gt;
                            &lt;item-header [item]=&quot;item&quot;
                                         [isOpen]=&quot;item === openItem&quot;
                                         (mouseover)=&quot;highlightedItem = item&quot;
                                         (mouseout)=&quot;_unhighlight(item)&quot;
                                         [ngClass]=&quot;{highlighted: item === highlightedItem, active: item === selectedItem}&quot;&gt;
                            &lt;/item-header&gt;
                        &lt;/accordion-heading&gt;

                        &lt;div *ngIf=&quot;!options?.headersOnly&quot;&gt;
                            &lt;resource-panel *ngIf=&quot;item === openItem&quot;
                                            [item]=&quot;item&quot;
                                            [model]=&quot;model&quot;
                                            [options]=&quot;options&quot;
                                            (saved)=&quot;_onSaved(item)&quot;
                                            (removed)=&quot;_onRemoved(item)&quot;
                                            (highlightedItemChange)=&quot;highlightedItemChange.emit($event)&quot;
                            &gt;&lt;/resource-panel&gt;
                        &lt;/div&gt;
                    &lt;/accordion-group&gt;
                &lt;/accordion&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `,
    styles: [`
        .input-select{
          min-width: 100px;
        }
        .highlighted {
          background-color: #e3d2d2;
        }
        .active {
          border: 2px solid #ff9999;
          padding: 2px;
        }
    `]
})
/**
 * The NestedResourceList component, provides functionality for editing lists of resources.
 * @extends {AbstractResourceList}
 */
export class NestedResourceList extends AbstractResourceList{
    /**
     *  the list of resources that can be added to the current list
     */
    @Input() possibleValues;

    _itemToInclude = null;

    /**
     * The constructor of the component
     * @param {ToastyService} toastyService - the service for showing notifications and error messages
     * @param {HighlightService} highlightService - the service that notifies nested components about currently highlighted item
     */
    constructor(toastyService: ToastyService, highlightService: HighlightService){
        super(highlightService);
        this._toastyService = toastyService;
    }

    /**
     * Initialize the component
     */
    ngOnInit(){
        super.ngOnInit();

        //If selectionOptions are not provided by parent, subscribe and get all for given types
        if (!this.possibleValues) {
            if (this.types.length === 1){
                this._ts = this.model[this.types[0]].p(&apos;all&apos;).subscribe(
                    (data) =&gt; { this.possibleValues = data; });
            } else {
                if (this.types.length &gt; 1){
                    let setToArray = new SetToArray();
                    let filterByClass = new FilterBy();

                    this._ts = this.model.Template.p(&apos;all&apos;).subscribe(
                        (data) =&gt; {this.possibleValues = new Set(
                            filterByClass.transform( setToArray.transform(data), [this.types, &apos;class&apos;]))});
                }
            }
        }
    }

    /**
     * Unsubscribe from subscriptions
     */
    ngOnDestroy() {
        if (this._ts) { this._ts.unsubscribe(); }
    }

    /**
     * Update the view in response to external data change (e.g., sort layers)
     * @param {Object} changes - the object defining input data changes
     */
    ngOnChanges(changes) {
        if (this.items &amp;&amp; this.options.ordered) {
            this.items.sort((a, b) =&gt; {
                return (a[&apos;--&gt;IsRadiallyAdjacent&apos;]
                    &amp;&amp; a[&apos;--&gt;IsRadiallyAdjacent&apos;][2]
                    &amp;&amp; a[&apos;--&gt;IsRadiallyAdjacent&apos;][2].includes(b))
            });
        }
    }

    //TODO: update new &quot;Follows&quot; relationship
    _onDragEnd(index){
        if (!this.options.ordered) { return; }
        //TODO: un-comment when the model libarry supports operations with this relationship (or other way to order)
        //IsRadiallyAdjacent relation has cardinality [0..*]
        // for (let i = 1; i &lt; this.items.length; i++){
        //     if (this.items[i][&apos;--&gt;IsRadiallyAdjacent&apos;] &amp;&amp; this.items[i][&apos;--&gt;IsRadiallyAdjacent&apos;][2]){
        //         if (!this.items[i][&apos;--&gt;IsRadiallyAdjacent&apos;][2].includes(this.items[i - 1])){
        //             this.items[i][&apos;--&gt;IsRadiallyAdjacent&apos;][2] = [this.items[i - 1]];
        //         }
        //     } else {
        //         this.model.isRadiallyAdjacent.new({1: this.items[i - 1], 2: this.items[i]});
        //     }
        // }
        // if (this.items.length &gt; 1) {
        //     if (this.items[this.items.length - 1][&apos;--&gt;IsRadiallyAdjacent&apos;] !== null){
        //         this.items[i][&apos;--&gt;IsRadiallyAdjacent&apos;].delete();
        //     }
        // }
        // this.updated.emit(this.items);
    }

    /**
     * Include a selected resource to the current list
     * @param {Resource} newItem - the selected resource to include to the current list
     */
    _onIncluded(newItem){
        if (newItem){
            if (this.items.indexOf(newItem) &lt; 0){
                this.items.push(newItem);
                this.updated.emit(this.items);
                this.added.emit(newItem);
                this.selectedItem = newItem;
            } else {
                this._toastyService.error(&quot;Selected resource is already included to the set!&quot;);
            }
        }
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
