<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/panels/AbstractResourceList.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/open-physiology/nested-resource-editor" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/PipeTransformModule.js~FilterBy.html">FilterBy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/PipeTransformModule.js~HideClass.html">HideClass</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/PipeTransformModule.js~OrderBy.html">OrderBy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/PipeTransformModule.js~PipeTransformModule.html">PipeTransformModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/PipeTransformModule.js~SetToArray.html">SetToArray</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common/components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/components/CustomSelectModule.js~CustomSelectModule.html">CustomSelectModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/components/CustomSelectModule.js~MultiSelectInput.html">MultiSelectInput</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/components/CustomSelectModule.js~SingleSelectInput.html">SingleSelectInput</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common/toolbars</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/toolbars/ToolbarSettingsModule.js~ToolbarPropertySettings.html">ToolbarPropertySettings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/common/toolbars/ToolbarSettingsModule.js~ToolbarSettingsModule.html">ToolbarSettingsModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/MeasurableGeneratorModule.js~MeasurableGenerator.html">MeasurableGenerator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/MeasurableGeneratorModule.js~MeasurableGeneratorModule.html">MeasurableGeneratorModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">panels</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/AbstractResourceList.js~AbstractResourceList.html">AbstractResourceList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/HighlightService.js~HighlightService.html">HighlightService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/ItemHeader.js~ItemHeader.html">ItemHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/NestedResourceList.js~NestedResourceList.html">NestedResourceList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/NestedResourceWidgetModule.js~NestedResourceWidget.html">NestedResourceWidget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/NestedResourceWidgetModule.js~NestedResourceWidgetModule.html">NestedResourceWidgetModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/ResourcePanelModule.js~ResourcePanel.html">ResourcePanel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/panels/ResourcePanelModule.js~ResourcePanelModule.html">ResourcePanelModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">test-app</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/test-app/app.js~TestApp.html">TestApp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/test-app/app.js~TestAppModule.html">TestAppModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">toolbars</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarAddModule.js~ToolbarAdd.html">ToolbarAdd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarAddModule.js~ToolbarAddModule.html">ToolbarAddModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarCommandsModule.js~ToolbarCommands.html">ToolbarCommands</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarCommandsModule.js~ToolbarCommandsModule.html">ToolbarCommandsModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarFilterModule.js~ToolbarFilter.html">ToolbarFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarFilterModule.js~ToolbarFilterModule.html">ToolbarFilterModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarSortModule.js~ToolbarSort.html">ToolbarSort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/toolbars/ToolbarSortModule.js~ToolbarSortModule.html">ToolbarSortModule</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/panels/AbstractResourceList.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import {Input, Output, EventEmitter} from &apos;@angular/core&apos;;
import {HighlightService} from &apos;./HighlightService.js&apos;;

/**
 * The AbstractResourceList class implements methods common for upper level and nested resource lists.
 */
export class AbstractResourceList {
    /**
     * @type {string} caption           - the header of the list
     */
    @Input() caption = &quot;Resources&quot;;
    /**
     * @type {Object} model  - the open-physiology model
     */
    @Input() model;
    /**
     * @type {Array&lt;Resource&gt;} items    - the list of displayed resources
     */
    @Input() items = [];
    /**
     * @type {Array&lt;string&gt;} types      - the list of displayed item types (resource classes)
     */
    @Input() types = [];

    /**
     * @type {Object} - visualization options
     * @property {boolean} options.ordered -
     */
    @Input() options = {};

    @Input(&apos;selectedItem&apos;) set selectedItem(item) {
        if (this._selectedItem !== item) {
            this._selectedItem = item;
            this.selectedItemChange.emit(item);
        }
    }
    get selectedItem() { return this._selectedItem; }
    @Input(&apos;highlightedItem&apos;) set highlightedItem(item) {
        if (this._highlightedItem !== item) {
            this._highlightedItem = item;
            this.highlightedItemChange.emit(item);
            this._highlightService.highlight(this._highlightedItem);
        }
    }
    get highlightedItem() { return this._highlightedItem; }

    /**
     * @emits added                 - a new item added to the list
     */
    @Output() added = new EventEmitter();
    /**
     * @emits removed               - an item removed from the list
     */
    @Output() removed = new EventEmitter();
    /**
     * @emits updated               - an item in the list has been updated
     */
    @Output() updated = new EventEmitter();
    /**
     * @emits selectedItemChange    - the selected item changed
     */
    @Output() selectedItemChange = new EventEmitter();
    /**
     * @emits highlightedItemChange - the highlighted item changed
     */
    @Output() highlightedItemChange = new EventEmitter();

    _selectedItem    = null;
    _highlightedItem = null;
    _openItem        = null;

    _zones = [];

    _sortByMode   = &quot;unsorted&quot;;
    _filterByMode = &quot;Name&quot;;
    _searchString = &quot;&quot;;

    /**
     * @param {HighlightService} highlightService - the service that notifies nested components about currently highlighted item
     */
    constructor(highlightService: HighlightService) {
        this._highlightService = highlightService;
        this._hs = this._highlightService.highlightedItemChanged$.subscribe(item =&gt; {
            if (this.items.includes(item) &amp;&amp; this._highlightedItem !== item){
                this._highlightedItem = item;
            }
        })
    }

    /**
     * Initialize the nested resource list: choose selected item and default parameters (e.g., visible classes)
     */
    ngOnInit() {
        if (!this.items) { this.items = []; }

        if (this.items[0] || !this.selectedItem) {
            this.selectedItem = this.items[0];
        }

        if (this.types.length === 0) {
            //If no specific classes were specified, it works with any class
            let visualClasses = [...this.model.Artefact.allSubclasses()].map(x =&gt; x.name);
            for (let cls of Object.values(this.model)){
                if (cls.isResource &amp;&amp; !cls.abstract &amp;&amp; !visualClasses.includes(cls.name)){
                    this.types.push(cls.name);
                    if (cls.name === this.model.Lyph.name){ this.types.push(&quot;LyphWithAxis&quot;); }
                }
            }
        }
        this._zones = this.types.map(x =&gt; x + &quot;_zone&quot;);
    }

    /**
     * On component destroy, unsubscribe from model library data handling events
     */
    ngOnDestroy() {
        if (this._hs) {
            this._hs.unsubscribe();
        }
    }

    _unhighlight(item) {
        if (this.highlightedItem === item) {
            this.highlightedItem = null;
        }
    }

    /**
     * Set resource with the open editor
     * @param {Resource} item - the resource with the open editor
     */
    set openItem(item){
        if (this._openItem !== item) {
            this._openItem = item;
        }
    }

    /**
     * @returns {Resource} - the resource with the open editor
     */
    get openItem(){
        return this._openItem;
    }

    /* Event processing */

    /**
     * Change sorting mode
     * @param {string} prop - the sorting mode
     */
    onSorted(prop) {
        this._sortByMode = prop.toLowerCase();
    }

    /**
     * Change filter settings
     * @param {Object} config - the parameters for filtering, mode and search string.
     */
    onFiltered(config) {
        this._filterByMode = config.mode.toLowerCase();
        this._searchString = config.filter;
    }

    /**
     * Save (commit) a given resource
     * @param {Resource} item - the resource to save (commit)
     */
    onSaved(item) {
        this.updated.emit(this.items);
        if (item === this.selectedItem) {
            this.selectedItemChange.emit(this.selectedItem);
        }
    }

    /**
     * Delete a given resource
     * @param {Resource} item - he resource to delete
     */
    onRemoved(item) {
        if (!this.items) return;
        let index = this.items.indexOf(item);
        if (index &gt; -1) this.items.splice(index, 1);
        if (item === this.selectedItem) {
            if (this.items.length &gt; 0){
                this.selectedItem = this.items[0];
            }
            else {
                this.selectedItem = null;
            }
        }
        item.delete();
        this.removed.emit(item);
        this.updated.emit(this.items);
    }

    /**
     * Create new resource
     * @param {string} clsName - the type of the resource to create
     */
    onAdded(clsName) {
        let options = {};
        if (clsName === &quot;LyphWithAxis&quot;) {
            clsName = this.model.Lyph.name;
            options.createAxis = true;
        }
        if (clsName === this.model.Lyph.name) {
            options.createRadialBorders = true;
        }

        let newItem = this.model[clsName].new({name: `New ${clsName}`}, options);

        if (clsName === this.model.Material.name) {
            let newType = this.model.Type.new({name: newItem.name, definition: newItem});
            newItem.p(&apos;name&apos;).subscribe(newType.p(&apos;name&apos;));
        }

        this.items.push(newItem);
        this.updated.emit(this.items);
        this.added.emit(newItem);
        this.selectedItem = newItem;
    }

    /**
     * The getClassLabel function provides an human readable label for open-physiology class
     * @param {Resource} clsName - the resource class name
     * @returns {string} - the human readable label
     */
    getClassLabel(clsName: string): string{
        if (!clsName) { return &quot;&quot;; }
        let label = clsName;
        label = label.replace(/([a-z])([A-Z])/g, &apos;$1 $2&apos;);
        label = label[0].toUpperCase() + label.substring(1).toLowerCase();
        return label;
    }

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
